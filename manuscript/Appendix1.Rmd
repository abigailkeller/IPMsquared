---
title: "Appendix 1: Description of data"
output: pdf_document
bibliography: appendix1.bib
---

# Appendix 1
The integrated population model provides a framework for synthesizing multiple demographic datasets to mutually inform shared parameters. In Appendix 1.1, we further describe the multi-year Drayton Harbor time series data (D1). In Appendix 1.2, we describe additional information about the size-at-age data (D2), and in Appendix 1.3, we further describe the mark-recapture data (D3).

## Appendix 1.1
The multi-year time series data (D1) was collected in Drayton Harbor, an enclosed bay in the Salish Sea in Washington State, USA.

**Figure A1.1:** Bathymetric map of Drayton Harbor. Colors indicate depth and black line indicates coast line.

```{r dh-figure, echo=FALSE, out.width="80%"}
knitr::include_graphics(
  "../figures/supplemental_map.png"
)
```

At Drayton Harbor, traps were baited and left to “soak” in intertidal and subtidal habitat for 24-48 hours. Trapped areas within Drayton Harbor include a large tideflat and the mouth of three creeks that feed into the bay (named "North", "Dakota Creek", "California Creek", and "Noname Creek"). After the "soak" time, traps were retrieved, and green crabs were counted and removed from the system. The carapace widths (CW) of green crabs were measured with vernier calipers between the tips of their fifth anterio-lateral spines to the nearest lowest mm. Multiple trap types (Fukui, Minnow, and Shrimp) with different size-selective removal rates were used. These traps have different mesh sizes and entrance openings: Fukui traps have 12 mm mesh with approximately 20 cm entrance openings; Gee-brand minnow traps have 6 mm mesh with approximately 5 cm entrances; Promar-brand 4-way Shrimp traps have 12.7 mm or 25.4 mm mesh size and approximately 10 cm entrance opening. These entrance and mesh sizes are approximate, however, as the traps can slightly change as they get used over time.

Data collected in Drayton Harbor data were subset to only include recruits (age < 1) that appear in a single cohort in the fall of each year (Figure 1B). This subset only removed three recruit individuals in 2022 from the dataset that were from an off-cycle recruitment cohort.

Below we describe the total removal effort and catch of European green crab (EGC, *C. maenas*) in Drayton Harbor (D1). While the removal count data is collected at many time points throughout the trapping season (April - October), we discretize the time intervals into biweekly periods in the model.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(kableExtra)
library(knitr)

# read in data
counts <- readRDS("../data/model_data/counts.rds")
f_index <- readRDS("../data/model_data/f_index.rds")
m_index <- readRDS("../data/model_data/m_index.rds")
s_index <- readRDS("../data/model_data/s_index.rds")
index_frac <- readRDS("../data/model_data/index_frac.rds")
totalt <- readRDS("../data/model_data/totalt.rds")
df_catch <- as.data.frame(matrix(NA, nrow = 0, ncol = 7))
colnames(df_catch) <- c("year", "F (catch)", "F (effort)",
                        "M (catch)", "M (effort)", "S (catch)", "S (effort)")
years <- c("2020", "2021", "2022", "2023")
for (i in seq_along(years)) {
  for (t in seq_along(1:totalt[i])) {
    count_f <- sum(rowSums(counts[t, , i, ]) * f_index[t, , i])
    count_s <- sum(rowSums(counts[t, , i, ]) * s_index[t, , i])
    count_m <- sum(rowSums(counts[t, , i, ]) * m_index[t, , i])
    effort_f <- sum(f_index[t, , i])
    effort_s <- sum(s_index[t, , i])
    effort_m <- sum(m_index[t, , i])
    vec <- c(years[i], count_f, effort_f, count_m, effort_m, count_s, effort_s)
    df_catch <- rbind(df_catch, vec)
  }
}

# get Julian day
biweek <- c(59, 76, 91, 106, 121, 137, 152, 167, 182, 198, 213, 
            229, 244, 259, 274, 290, 305, 320, 335)
index_full <- index_frac / 14 * 365 + 3
julian_day_df <- as.data.frame(matrix(NA, nrow = max(totalt), ncol = 4))
for (i in 1:4) {
  for (t in 1:totalt[i]) {
    julian_day_df[t, i] <- biweek[index_full[t, i]]
  }
}
julian_day <- c(julian_day_df[1:totalt[1], 1], julian_day_df[1:totalt[2], 2],
                julian_day_df[1:totalt[3], 3], julian_day_df[1:totalt[4], 4])

# get all catch
df_catch <- cbind(julian_day, df_catch)
colnames(df_catch) <- c("Julian day", "year", "F (catch)", "F (effort)",
                        "M (catch)", "M (effort)", "S (catch)", "S (effort)")
```

\newpage

**Table A1.1:** Number of crabs caught and total removal effort (number of traps) during each biweek and year. Julian day signifies the first Julian day of the discretized biweek period. F, M, and S correspond to Fukui, Minnow, and Shrimp traps, respectively.

```{r, echo = FALSE}
# Render table
knitr::kable(
  df_catch
)
```

\newpage

## Appendix 1.2

Size-at-age data (D2) were collected from crab removal observations associated with range expansions in northeastern Pacific estuaries documented by Yamada et al. 2021. Since the colonizing cohorts of crabs following expansion events were relatively easy to identify as they age over time, Yamada et al. 2021 assigned a year class to captured crabs based on the location of collection, assumed expansion event, date of capture, carapace width, sex, and molt conditions [@yamada2021ocean].

For example, El Niño events, with their characteristic warm water temperatures and enhanced northward transport by the Davidson Current, are especially favorable to the survival and transport of larvae hundreds of kilometers from source populations. The 1997 to 1998 El Niño resulted in the colonization of embayments in Oregon, coastal Washington, and on the west coast of Vancouver Island from California, and the El Niño of 2015 to 2016 and the Pacific Warm Blob were linked to range expansion into the Salish Sea. More local range expansions in other areas also occurred during non-El Niño years.

Yamada et al. 2021 report an estimated year class for captured crabs, which corresponds to the first year of growth after settlement from its planktonic larval stage. We use this estimated year class and the reported crab capture date from this dataset to estimate the age of captured individuals. We assume planktonic settlement in March. For example, for a crab captured in September 2000 with estimated year class of 1998 would be assigned an age of 2.5.

```{r, echo = FALSE, warning = FALSE, message = FALSE}
growth_data <- read.csv("../data/growthdata.csv")
growth_data <- growth_data[!growth_data$Waterbody == "Drayton Harbor", ]
growth_summary <- growth_data %>%
  group_by(Year, Waterbody) %>%
  summarize(n = n())
```

**Table A1.2:** Number of size-at-age records during each year and waterbody in the northeastern Pacific.

```{r, echo = FALSE}
# Render table
knitr::kable(
  growth_summary
)
```


### Appendix 1.3

The mark-recapture data (D3) were collected as part of a mark-recapture experiment in July through November 2024 at Roche Cove on Vancouver Island in British Columbia, Canada. 

Green crab were trapped using baited Fukui traps, with trap lines consisting of six traps placed 10 meters apart. Lines were set approximately 10 m apart and set both parallel and perpendicular to the shore line to create an equal grid across the site, and traps "soaked" for about 24 hours before being checked. Captured crabs were measured, sexed, and color and health determined before marking. All crab were tagged using small sequentially numbered disk tags, with the edges trimmed down to size, glued to the hind end of the carapace using Crazy Glue, with accelerant sprayed lightly on to set. Crab were held in submerged sealed Fukui traps for 24-48 hours and, prior to release, the tags were individually checked for retention. Crab were evenly dispersed throughout the trapping location to ensure equal re-distribution across the site.

The experiment took place over four time periods, $t \in \{0 ... 3\}$. Marking events took place at $t \in \{0 ... 2\}$, where crabs were marked and released back into the environment. Recapture events took place at $t \in \{1 ... 3\}$, and recaptured crabs at $t \in \{1,  2\}$ were released back into the environment (Figure A1.2).

**Figure A1.2:** Conceptual diagram of mark-recapture schema. The number of crabs marked at time $t$ of size $x$ is $m^{\text{mc}}_t(x)$, the number of crabs recaptured at time $t$ of size $x$ is $r^{\text{mc}}_t(x)$, and the total number of crabs marked at time $t$ of size $x$ is $N^{\text{mc}}_t(x)$.

```{r markrecap-figure, echo=FALSE, out.width="100%"}
knitr::include_graphics(
  "../figures/appendix_mark_recapture_conceptual-01.png"
)
```

Across the four time periods, 234 total traps were set, 1676 crabs were marked, and 88 crabs were recaptured (Table A1.3).

```{r, echo = FALSE, message = FALSE, warning = FALSE}
total_traps <- readRDS("../data/model_data/roche_mc_totalo.rds")
total_traps$t = 0:3

traps_table <- total_traps[, c("t", "julian_day", "n", "marked", "recap")]

colnames(traps_table) <- c("t", "Julian day", "Total traps set", "Total marked", 
                           "Total recaptured")
```

**Table A1.3:** Total number of Fukui traps set, crabs marked (across all sizes), and crabs recaptured (across all sizes) for each of the four mark-recapture time periods.

```{r, echo = FALSE}
# Render table
knitr::kable(
  traps_table
)
```


# References
